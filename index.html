<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Nostra – Scorebord</title>

<style>
  :root {
    --quiz-red: #E53935;
    --spes-green: #2E7D32;
    --spes-yellow: #FDD835;
    --light-green: #A5D6A7;

    --bg: #f6f7f8;
    --card: #ffffff;
    --text: #222;
    --muted: #60666d;
    --line: #e1e2e5;

    /* Nieuwe kleur voor niet‑podiumplaatsen */
    --rank-default: #d5d7db;
  }

  body {
    margin: 0;
    background: var(--bg);
    font-family: system-ui, "Segoe UI", Roboto, Arial, sans-serif;
  }

  /* HEADER */
  .site-header {
    background: white;
    border-bottom: 4px solid var(--spes-green);
    padding: 20px;
  }

  .brand {
    max-width: 1050px;
    margin: 0 auto;
    display: flex;
    gap: 20px;
    align-items: center;
  }

  /* LOGO — GROTER GEMAAKT */
  .brand__logo {
    height: clamp(60px, 8vw, 90px);
    width: auto;
  }

  .brand__titles {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .brand__title {
    margin: 0;
    font-size: clamp(32px, 4vw, 48px);
    color: var(--quiz-red);
    font-weight: 900;
  }

  .brand__subtitle {
    margin: 0;
    color: var(--muted);
  }

  /* BUTTONS */
  .actions {
    max-width: 1050px;
    margin: 20px auto;
    display: flex;
    gap: 10px;
    justify-content: center;
    padding: 0 20px;
  }

  .btn {
    padding: 10px 18px;
    border-radius: 10px;
    border: 2px solid transparent;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
  }

  .btn-primary {
    background: var(--spes-green);
    color: white;
  }

  .btn-secondary {
    background: white;
    border: 2px solid var(--light-green);
    color: var(--spes-green);
  }

  /* STATUS */
  #meta {
    text-align: center;
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 10px;
  }

  /* SCOREBORD */
  .wrap {
    max-width: 1050px;
    margin: 0 auto;
    padding: 0 20px 40px;
  }

  .grid {
    display: grid;
    gap: 14px;
  }

  .card {
    display: flex;
    align-items: center;
    gap: 14px;
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 14px 16px;
    box-shadow:
      0 2px 2px rgba(0,0,0,0.03),
      0 5px 14px rgba(0,0,0,0.05);
  }

  /* RANK BADGES */
  .place {
    min-width: 48px;
    height: 48px;
    font-size: 20px;
    border-radius: 12px;
    display: grid;
    place-items: center;
    font-weight: 800;
    color: #333;
    background: var(--rank-default);
  }

  .place.gold {
    background: linear-gradient(135deg, var(--spes-yellow), #ffb300);
  }

  .place.silver {
    background: linear-gradient(135deg, #e0e0e0, #bdbdbd);
  }

  .place.bronze {
    background: linear-gradient(135deg, #ffcc80, #fb8c00);
  }

  .team {
    flex: 1;
    font-size: 20px;
    font-weight: 700;
  }

  .team a {
    color: var(--text);
    text-decoration: none;
  }

  .team a:hover {
    text-decoration: underline;
  }

  .bar-wrap {
    width: 100%;
    height: 8px;
    background: #efefef;
    border-radius: 999px;
    overflow: hidden;
  }

  .bar {
    height: 100%;
    background: var(--spes-green);
    width: 0%;
    transition: 0.5s ease;
  }

  .score {
    width: 60px;
    text-align: right;
    font-size: 22px;
    font-weight: 700;
  }
</style>
</head>

<body>

<header class="site-header">
  <div class="brand">
    assets/ouderraad-logo.png
    <div class="brand__titles">
      <h1 class="brand__title">Quiz Nostra</h1>
      <p class="brand__subtitle">Live scorebord</p>
    </div>
  </div>
</header>

<div class="actions">
  <button id="btnAdd" class="btn btn-primary">+ Voeg team toe</button>
  <button id="btnUndo" class="btn btn-secondary">– Verwijder laatste</button>
  <button id="btnAll" class="btn btn-secondary">Toon alle teams</button>
  <button id="btnReset" class="btn btn-secondary">Reset</button>
</div>

<div id="meta">Laden…</div>

<div class="wrap">
  <div id="list" class="grid"></div>
</div>

<script>
/* -------- CONFIG ---------- */
const CSV_URL =
 "https://docs.google.com/spreadsheets/d/e/2PACX-1vTbCFR9XqM4nMvii1ZbzYpDcsoG8qONnw5w5MogMDWmwTNzCd7KhQ9kFw94jTGlWIWy6Vt-JsHsJokY/pub?gid=0&single=true&output=csv";
const REFRESH_MS = 5000;

let fullData = [];
let visibleCount = 0;

function roundNumberFromName(n){
  const m = n.toLowerCase().match(/r(?:onde)?\s*(\d+)/);
  return m ? parseInt(m[1]) : null;
}

async function fetchCSV(url){
  const r = await fetch(url + "&_t=" + Date.now(), {cache:"no-store"});
  return await r.text();
}

function parseCSV(text){
  const rows = text.trim().split(/\r?\n/)
    .map(r => r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)
    .map(x => x.replace(/^"|"$/g,"")));

  const headers = rows[0];
  const hLow = headers.map(h=>h.toLowerCase());

  const teamIdx = hLow.indexOf("team");
  const tokenIdx= hLow.indexOf("token");

  const roundCols = headers
    .map((h,i)=>({label:h,i,nr:roundNumberFromName(h)}))
    .filter(o=>o.nr!==null)
    .sort((a,b)=>a.nr-b.nr);

  return rows.slice(1).map(r=>{
    let total=0;
    for(const col of roundCols){
      total+=Number(r[col.i]||0);
    }
    return {team:r[teamIdx], token:r[tokenIdx], total};
  }).filter(x=>x.team);
}

function computeRanks(list){
  list.sort((a,b)=>b.total-a.total||a.team.localeCompare(b.team));
  let prev=null, rank=0;
  list.forEach((x,i)=>{
    if(prev===null || x.total<prev) rank=i+1;
    x.rank = rank;
    prev=x.total;
  });
  return list;
}

function render(list){
  const root = document.getElementById("list");
  root.innerHTML = "";

  const shown = list.slice(-visibleCount);
  const max = Math.max(1,...shown.map(x=>x.total));

  shown.forEach(t=>{
    const card=document.createElement("div");
    card.className="card";

    const p=document.createElement("div");
    p.className="place";

    if(t.rank===1) p.classList.add("gold");
    else if(t.rank===2) p.classList.add("silver");
    else if(t.rank===3) p.classList.add("bronze");

    p.textContent=t.rank;

    const nm=document.createElement("div");
    nm.className="team";
    const a=document.createElement("a");
    a.href="team.html?" + (t.token ? "t="+encodeURIComponent(t.token) : "team="+encodeURIComponent(t.team));
    a.textContent=t.team;
    nm.appendChild(a);

    const barW=document.createElement("div");
    barW.className="bar-wrap";
    const bar=document.createElement("div");
    bar.className="bar";
    bar.style.width = Math.round((t.total/max)*100) + "%";
    barW.appendChild(bar);

    const sc=document.createElement("div");
    sc.className="score";
    sc.textContent=t.total;

    card.appendChild(p);
    card.appendChild(nm);
    card.appendChild(barW);
    card.appendChild(sc);

    root.appendChild(card);
  });

  const meta=document.getElementById("meta");
  const count = shown.length;
  meta.textContent =
    (count ? `Getoond: ${count}/${list.length} – ` : "") +
    "Laatst bijgewerkt: " + new Date().toLocaleTimeString();

  btnAdd.disabled   = visibleCount>=list.length;
  btnUndo.disabled  = visibleCount<=0;
  btnAll.disabled   = visibleCount>=list.length;
  btnReset.disabled = visibleCount<=0;
}

async function tick(){
  const csv=await fetchCSV(CSV_URL);
  fullData = computeRanks(parseCSV(csv));
  if(visibleCount>fullData.length) visibleCount=fullData.length;
  render(fullData);
  setTimeout(tick,REFRESH_MS);
}

btnAdd.onclick  = ()=>{visibleCount++; render(fullData);}
btnUndo.onclick = ()=>{visibleCount=Math.max(0,visibleCount-1); render(fullData);}
btnAll.onclick  = ()=>{visibleCount=fullData.length; render(fullData);}
btnReset.onclick= ()=>{visibleCount=0; render(fullData);}

tick();
</script>

</body>
</html>